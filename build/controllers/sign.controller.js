"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.validationRegister=exports.renderRegister=exports.validationLogin=exports.renderLogin=void 0;var _Users=_interopRequireDefault(require("../models/Users.js")),_passport=_interopRequireDefault(require("passport")),_config=require("../config.js");function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function asyncGeneratorStep(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){return void c(a)}h.done?b(i):Promise.resolve(i).then(d,e)}function _asyncToGenerator(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){function f(a){asyncGeneratorStep(h,d,e,f,g,"next",a)}function g(a){asyncGeneratorStep(h,d,e,f,g,"throw",a)}var h=a.apply(b,c);f(void 0)})}}var renderLogin=function(a,b){return b.render("sign/login",{title:"GikEdu - Inicia sesi\xF3n",contentHeader:{partial:function partial(){return"button"},args:{label:"a",class:"button-ghost",url:"/",value:"Regresar"}},host:_config.host})};exports.renderLogin=renderLogin;var validationLogin=_passport["default"].authenticate("local",{successRedirect:"/App",failureRedirect:"/signin",failureFlash:!0});exports.validationLogin=validationLogin;var renderRegister=/*#__PURE__*/function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b,c){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",c.render("sign/register",{title:"GikEdu - Registro",contentHeader:{partial:function(){return"button"},args:{label:"a",class:"button-ghost",url:"/",value:"Regresar"}},host:_config.host}));case 1:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}();exports.renderRegister=renderRegister;var validationRegister=/*#__PURE__*/function(){var a=_asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function a(b,c){var d,e,f,g,h,i,j,k,l,m,n;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(d=b.body,e=d.name,f=d.code,g=d.username,h=d.password,i=d.confirm_password,j=d.email,k=[],h!=i&&k.push({text:"Las contrase\xF1as no coinciden"}),0<!h.length&&k.push({text:"El campo esta vacio"}),4>=h&&k.push({text:"La contrase\xF1a es corta, digite una mas larga"}),console.log(b.body),console.log(k),!k.length){a.next=11;break}c.redirect("/signup"),a.next=24;break;case 11:return a.next=13,_Users["default"].findOne({email:j});case 13:return l=a.sent,l&&(b.flash("error_msg","El correo ya esta en uso"),c.redirect("/signup")),m=new School({name:e,code:f}),a.next=18,m.save();case 18:return n=new _Users["default"]({username:g,password:h,email:j,school:m._id,rol:"admin"}),a.next=21,n.encryptPassword(h);case 21:return n.password=a.sent,a.next=24,n.save(function(){c.redirect("/signin")});case 24:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}();exports.validationRegister=validationRegister;